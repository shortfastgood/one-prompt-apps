// ===================================================
//  Tetromino definitions – SRS (Super Rotation System)
// ===================================================

// Each piece is stored as an array of 4 rotation states.
// Each rotation state is a flat array of 16 values (4×4 grid, row-major).
// 1 = filled cell, 0 = empty.

export const PIECES = {
  I: {
    color: '#00cfcf',
    shadow: 'rgba(0, 207, 207, 0.3)',
    rotations: [
      [0,0,0,0,
       1,1,1,1,
       0,0,0,0,
       0,0,0,0],
      [0,0,1,0,
       0,0,1,0,
       0,0,1,0,
       0,0,1,0],
      [0,0,0,0,
       0,0,0,0,
       1,1,1,1,
       0,0,0,0],
      [0,1,0,0,
       0,1,0,0,
       0,1,0,0,
       0,1,0,0],
    ],
  },
  O: {
    color: '#f0d000',
    shadow: 'rgba(240, 208, 0, 0.3)',
    rotations: [
      [0,1,1,0,
       0,1,1,0,
       0,0,0,0,
       0,0,0,0],
      [0,1,1,0,
       0,1,1,0,
       0,0,0,0,
       0,0,0,0],
      [0,1,1,0,
       0,1,1,0,
       0,0,0,0,
       0,0,0,0],
      [0,1,1,0,
       0,1,1,0,
       0,0,0,0,
       0,0,0,0],
    ],
  },
  T: {
    color: '#a000f0',
    shadow: 'rgba(160, 0, 240, 0.3)',
    rotations: [
      [0,1,0,0,
       1,1,1,0,
       0,0,0,0,
       0,0,0,0],
      [0,1,0,0,
       0,1,1,0,
       0,1,0,0,
       0,0,0,0],
      [0,0,0,0,
       1,1,1,0,
       0,1,0,0,
       0,0,0,0],
      [0,1,0,0,
       1,1,0,0,
       0,1,0,0,
       0,0,0,0],
    ],
  },
  S: {
    color: '#00c000',
    shadow: 'rgba(0, 192, 0, 0.3)',
    rotations: [
      [0,1,1,0,
       1,1,0,0,
       0,0,0,0,
       0,0,0,0],
      [0,1,0,0,
       0,1,1,0,
       0,0,1,0,
       0,0,0,0],
      [0,0,0,0,
       0,1,1,0,
       1,1,0,0,
       0,0,0,0],
      [1,0,0,0,
       1,1,0,0,
       0,1,0,0,
       0,0,0,0],
    ],
  },
  Z: {
    color: '#f00000',
    shadow: 'rgba(240, 0, 0, 0.3)',
    rotations: [
      [1,1,0,0,
       0,1,1,0,
       0,0,0,0,
       0,0,0,0],
      [0,0,1,0,
       0,1,1,0,
       0,1,0,0,
       0,0,0,0],
      [0,0,0,0,
       1,1,0,0,
       0,1,1,0,
       0,0,0,0],
      [0,1,0,0,
       1,1,0,0,
       1,0,0,0,
       0,0,0,0],
    ],
  },
  J: {
    color: '#0050f0',
    shadow: 'rgba(0, 80, 240, 0.3)',
    rotations: [
      [1,0,0,0,
       1,1,1,0,
       0,0,0,0,
       0,0,0,0],
      [0,1,1,0,
       0,1,0,0,
       0,1,0,0,
       0,0,0,0],
      [0,0,0,0,
       1,1,1,0,
       0,0,1,0,
       0,0,0,0],
      [0,1,0,0,
       0,1,0,0,
       1,1,0,0,
       0,0,0,0],
    ],
  },
  L: {
    color: '#f0a000',
    shadow: 'rgba(240, 160, 0, 0.3)',
    rotations: [
      [0,0,1,0,
       1,1,1,0,
       0,0,0,0,
       0,0,0,0],
      [0,1,0,0,
       0,1,0,0,
       0,1,1,0,
       0,0,0,0],
      [0,0,0,0,
       1,1,1,0,
       1,0,0,0,
       0,0,0,0],
      [1,1,0,0,
       0,1,0,0,
       0,1,0,0,
       0,0,0,0],
    ],
  },
};

// SRS wall kick data for pieces J,L,S,T,Z
// [fromRotation][toRotation] = array of (dx,dy) offsets to try
// (0→1 means rotating clockwise from spawn state)
export const WALL_KICKS_JLSTZ = {
  '0>1': [[ 0,0],[-1,0],[-1,1],[ 0,-2],[-1,-2]],
  '1>0': [[ 0,0],[ 1,0],[ 1,-1],[ 0, 2],[ 1, 2]],
  '1>2': [[ 0,0],[ 1,0],[ 1,-1],[ 0, 2],[ 1, 2]],
  '2>1': [[ 0,0],[-1,0],[-1, 1],[ 0,-2],[-1,-2]],
  '2>3': [[ 0,0],[ 1,0],[ 1, 1],[ 0,-2],[ 1,-2]],
  '3>2': [[ 0,0],[-1,0],[-1,-1],[ 0, 2],[-1, 2]],
  '3>0': [[ 0,0],[-1,0],[-1,-1],[ 0, 2],[-1, 2]],
  '0>3': [[ 0,0],[ 1,0],[ 1, 1],[ 0,-2],[ 1,-2]],
};

// SRS wall kick data for I piece
export const WALL_KICKS_I = {
  '0>1': [[ 0,0],[-2,0],[ 1,0],[-2,-1],[ 1, 2]],
  '1>0': [[ 0,0],[ 2,0],[-1,0],[ 2, 1],[-1,-2]],
  '1>2': [[ 0,0],[-1,0],[ 2,0],[-1, 2],[ 2,-1]],
  '2>1': [[ 0,0],[ 1,0],[-2,0],[ 1,-2],[-2, 1]],
  '2>3': [[ 0,0],[ 2,0],[-1,0],[ 2, 1],[-1,-2]],
  '3>2': [[ 0,0],[-2,0],[ 1,0],[-2,-1],[ 1, 2]],
  '3>0': [[ 0,0],[ 1,0],[-2,0],[ 1,-2],[-2, 1]],
  '0>3': [[ 0,0],[-1,0],[ 2,0],[-1, 2],[ 2,-1]],
};

// Ordered bag sequence helper
export const PIECE_TYPES = Object.keys(PIECES); // ['I','O','T','S','Z','J','L']

/** Generate a shuffled 7-bag */
export function newBag() {
  const bag = [...PIECE_TYPES];
  for (let i = bag.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [bag[i], bag[j]] = [bag[j], bag[i]];
  }
  return bag;
}
